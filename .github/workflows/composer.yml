name: Composer test

on:
  push:
    branches:
      - 'master'
      - 'feat/**'
      - 'fix/**'
      - 'chore/**'
      - 'dev-**'

jobs:
  build:
    runs-on: ubuntu-latest
    container: shivammathur/node:latest-amd64
    strategy:
      matrix:
        version: ["7.4", "8.0", "8.1", "8.2", "8.3"]

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: "${{ matrix.version }}"
        tools: composer
        extensions: pdo_mysql, pdo_sqlite, pdo_pgsql, gettext, openssl, pdo, sqlite3, posix, mbstring
        coverage: none

    - name: print PHP version
      run: echo ${{ steps.setup-php.outputs.php-version }}

    - name: print PHP extensions
      run: php -m

    - name: print composer version
      run: composer --version

    - name: Composer install
      run: composer install --no-dev

    - name: Composer validate
      run: composer validate

    - name: Composer check
      run: composer check
